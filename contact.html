<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Contact Us - Silky Road</title>

<link rel="icon" href="/favicon.png">
<link rel="stylesheet" href="styles.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/supabase-config.js"></script>

<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;background:#f7f7f9;color:#222}
.header{background:#fff;border-bottom:1px solid #e4e4e8}
.container{max-width:1100px;margin:0 auto;padding:16px}
nav{display:flex;align-items:center;justify-content:space-between}
nav .links a{margin-left:12px;text-decoration:none;color:#333;font-weight:600}
.banner img{width:100%;height:auto;display:block}
.main{flex:1}
.footer{background:#222;color:#fff;padding:12px;margin-top:20px;text-align:center}
input, textarea{width:100%;padding:8px;margin-bottom:8px;border:1px solid #cfcfd3;border-radius:4px}
button, input[type=submit]{background:#2b6ef6;color:#fff;border:none;padding:10px 14px;border-radius:6px;cursor:pointer}
</style>

</head>
<body>

<!-- HEADER -->
<div id="header"></div>
<script>
  fetch("header.html?v=1")
    .then(r => r.text())
    .then(d => document.getElementById("header").innerHTML = d)
    .catch(e => console.error("Header load failed:", e));
</script>

<!-- BANNER -->
<div class="banner"><img src="banner.jpg" alt="Banner"></div>

<!-- MAIN CONTENT -->
<main class="container">
  <h2>Contact Us</h2>
  <p>Fill in the form below to contact us.</p>

  <form id="contactForm">
    <label>First Name<input id="firstName" required></label>
    <label>Last Name<input id="lastName" required></label>
    <label>Email Address<input id="email" type="email" required></label>
    <label>Message<textarea id="message" rows="6" required></textarea></label>
    <input type="submit" value="Send">
  </form>

  <div id="status"></div>
</main>

<!-- FOOTER -->
<footer class="footer">Silky Road © 2025-2026</footer>

<!-- SUPABASE -->
<script src="https://unpkg.com/@supabase/supabase-js/dist/umd/supabase.js"></script>
<script src="js/supabase-config.js"></script>

<!-- SEND EMAIL USING RESEND -->
<script>
async function sendEmail(firstName, lastName, email, message) {
  const resendApiKey = "re_UHYUfTuY_CtDK1eiG3mRYMoHXVjDCSLGo";  //  

  const payload = {
    from: "Silky Road <noreply@silkyroad.vercel.app>",
    to: ["andyfishermanbook@gmail.com"],  // 
    subject: "New Contact Form Message",
    html: `
      <h3>New message from Silky Road Contact Form</h3>
      <p><strong>Name:</strong> ${firstName} ${lastName}</p>
      <p><strong>Email:</strong> ${email}</p>
      <p><strong>Message:</strong><br>${message}</p>
    `
  };

  const response = await fetch("https://api.resend.com/emails", {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${resendApiKey}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify(payload)
  });

  return response.json();
}
</script>

<!-- FORM HANDLER -->
<script>
const supabaseClient = supabaseJs.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

document.getElementById('contactForm').addEventListener('submit', async function(e){
  e.preventDefault();

  const firstName = document.getElementById('firstName').value.trim();
  const lastName = document.getElementById('lastName').value.trim();
  const email = document.getElementById('email').value.trim();
  const message = document.getElementById('message').value.trim();

  document.getElementById('status').textContent = 'Sending...';

  try {
    // 1️⃣ Save to Supabase
    const { error } = await supabaseClient.from('contact_messages').insert([{
      first_name: firstName,
      last_name: lastName,
      email: email,
      message: message,
      created_at: new Date().toISOString()
    }]);

    if (error) throw error;

    // 2️⃣ Email via Resend
    await sendEmail(firstName, lastName, email, message);

    document.getElementById('status').textContent = 'Message sent successfully!';
    document.getElementById('contactForm').reset();

  } catch (err) {
    console.error(err);
    document.getElementById('status').textContent = 'Error sending message.';
  }
});
</script>

</body>
</html>
