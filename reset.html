<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" href="/favicon.png">
<title>Reset Password â€“ Silky Road</title>
<link rel="stylesheet" href="styles.css">

<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f7f7f9;padding:0;margin:0}
.container{max-width:500px;margin:80px auto;background:#fff;padding:20px;border:1px solid #ddd;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.05);}
.input-field{width:100%;padding:12px;font-size:16px;margin-bottom:12px;border-radius:6px;border:1px solid #ccc;}
.btn-blue{width:100%;padding:12px;background:#2b6ef6;color:#fff;border:none;border-radius:6px;font-size:16px;cursor:pointer;}
.error-text{color:#d00;}
.success-text{color:#089600;}
</style>
</head>

<body>

<div class="container">
  <h2>Reset Your Password</h2>
  <p>Enter your new password below.</p>

  <input id="newPass" class="input-field" type="password" placeholder="New password">
  <input id="confirmPass" class="input-field" type="password" placeholder="Confirm password">
  
  <button id="resetBtn" class="btn-blue">Update Password</button>

  <p id="resetMessage"></p>
</div>

<script type="module">
import { supabase } from "./js/supabase-config.js";

const hash = window.location.hash;
const params = new URLSearchParams(hash.substring(1));
const type = params.get("type");

const resetBtn = document.getElementById("resetBtn");
const msg = document.getElementById("resetMessage");

/* Must detect recovery type */
if (type !== "recovery") {
  msg.textContent = "Invalid or expired reset link.";
  msg.className = "error-text";
}

/* SUBMIT NEW PASSWORD */
resetBtn.onclick = async ()=>{

  const p1 = newPass.value.trim();
  const p2 = confirmPass.value.trim();

  if (p1 !== p2){
    msg.textContent = "Passwords do not match.";
    msg.className = "error-text";
    return;
  }

  const { error } = await supabase.auth.updateUser({ password: p1 });

  if (error){
    msg.textContent = error.message;
    msg.className = "error-text";
  } else {
    msg.textContent = "Password updated! Redirecting...";
    msg.className = "success-text";
    setTimeout(()=>window.location.href="login.html", 1800);
  }
};
</script>

</body>
</html>
