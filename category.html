<!doctype html>
<html lang="en">
<head>
<link rel="stylesheet" href="styles.css">  
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" href="/favicon.png">
<title>Browse Category ‚Äì Silky Road</title>

<meta name="description" content="Browse digital products by category on Silky Road Marketplace.">
<meta name="keywords" content="digital products, category, ebooks, downloads, silky road">

<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;background:#f7f7f9;color:#222}
.header{background:#fff;border-bottom:1px solid #e4e4e8}
.container{max-width:1100px;margin:0 auto;padding:16px}
.banner img{width:100%;height:auto;display:block}

/* Sticky wrapper for category bar */
.category-bar-wrapper{
  position: sticky;
  top: 0;
  z-index: 50;
  background:#f7f7f9;
}

/* CATEGORY NAVIGATION BAR (centered, improved) */
.category-bar{
  max-width:1100px;
  margin:20px auto;
  background:#ffffff;
  padding:12px 16px;
  border:1px solid #e6e6ea;
  display:flex;
  gap:24px;
  font-weight:bold;
  flex-wrap:wrap;
  border-radius:8px;
}

/* Main parent category item */
.category-bar > div{
  position:relative;
  cursor:pointer;
  padding:6px 0;
}

/* Dropdown menu */
.category-bar div ul{
  display:none;
  position:absolute;
  background:#fff;
  list-style:none;
  padding:10px 14px;
  margin:0;
  border:1px solid #ccc;
  width:220px;
  z-index:999;
  border-radius:6px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

/* Show dropdown on hover */
.category-bar div:hover ul{
  display:block;
}

/* Sub items */
.category-bar ul li{
  padding:6px 0;
}

/* Links */
.category-bar a{
  text-decoration:none;
  color:#333;
  font-weight:normal;
  transition:color 0.2s ease;
}

/* Hover link effect */
.category-bar a:hover{
  color:#2b6ef6;
}

/* Parent category hover color */
.category-bar > div:hover{
  color:#2b6ef6;
}

/* Product card layout */
.card{
  background:#fff;
  padding:12px;
  border:1px solid #e6e6ea;
  border-radius:8px;
  margin-bottom:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
}

.product-grid{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
}
.card.product-card{
  width:calc(25% - 9px);
}
.card.product-card img{
  width:100%;
  border-radius:6px;
}

@media(max-width:600px){
  .card.product-card{width:calc(50% - 6px);}
  .category-bar{
    flex-direction:column;
    gap:12px;
    padding:16px;
  }
  .category-bar > div{
    width:100%;
  }
}

.logo-img { height: 39px; width: auto; vertical-align: middle; }
.footer{background:#222;color:#fff;padding:12px;margin-top:20px;text-align:center}
.text-muted{color:#777;font-size:13px}
</style>
</head>

<body>

<!-- HEADER -->
<div id="header"></div>
<script>
  fetch("header.html?v=3")
    .then(r => r.text())
    .then(d => document.getElementById("header").innerHTML = d)
    .catch(e => console.error("Header load failed:", e));
</script>

<!-- BANNER -->
<div class="banner">
  <img src="banner.jpg" alt="Digital Marketplace Banner">
</div>

<!-- STICKY CATEGORY NAVIGATION BAR -->
<div class="category-bar-wrapper">
  <div class="category-bar">
    <div>üè∑Ô∏è All
      <ul>
        <li><a href="category.html?category=All">All Products</a></li>
      </ul>
    </div>

    <div>üìö Educational
      <ul>
        <li><a href="category.html?category=Educational&sub=eBooks">eBooks</a></li>
        <li><a href="category.html?category=Educational&sub=Online Courses">Online Courses</a></li>
        <li><a href="category.html?category=Educational&sub=Worksheets">Worksheets</a></li>
        <li><a href="category.html?category=Educational&sub=Tutorials">Tutorials</a></li>
        <li><a href="category.html?category=Educational&sub=Digital Workbooks">Digital Workbooks</a></li>
      </ul>
    </div>

    <div>üé® Creative Assets
      <ul>
        <li><a href="category.html?category=Creative Assets&sub=Stock Photos">Stock Photos</a></li>
        <li><a href="category.html?category=Creative Assets&sub=Videos">Videos</a></li>
        <li><a href="category.html?category=Creative Assets&sub=Music / Audio Tracks">Music / Audio Tracks</a></li>
        <li><a href="category.html?category=Creative Assets&sub=Sound Effects">Sound Effects</a></li>
        <li><a href="category.html?category=Creative Assets&sub=Digital Art">Digital Art</a></li>
        <li><a href="category.html?category=Creative Assets&sub=Fonts">Fonts</a></li>
        <li><a href="category.html?category=Creative Assets&sub=Brushes">Brushes</a></li>
        <li><a href="category.html?category=Creative Assets&sub=Lightroom Presets">Lightroom Presets</a></li>
      </ul>
    </div>

    <div>üìà Productivity
      <ul>
        <li><a href="category.html?category=Productivity&sub=Planners">Planners</a></li>
        <li><a href="category.html?category=Productivity&sub=Journals">Journals</a></li>
        <li><a href="category.html?category=Productivity&sub=Social Media Packs">Social Media Packs</a></li>
        <li><a href="category.html?category=Productivity&sub=Business Templates">Business Templates</a></li>
        <li><a href="category.html?category=Productivity&sub=Spreadsheets">Spreadsheets</a></li>
        <li><a href="category.html?category=Productivity&sub=Notion Templates">Notion Templates</a></li>
      </ul>
    </div>

    <div>üìÅ Templates
      <ul>
        <li><a href="category.html?category=Templates&sub=Canva Templates">Canva Templates</a></li>
        <li><a href="category.html?category=Templates&sub=Digital Stickers">Digital Stickers</a></li>
        <li><a href="category.html?category=Templates&sub=Printable Games">Printable Games</a></li>
        <li><a href="category.html?category=Templates&sub=Craft Patterns">Craft Patterns</a></li>
        <li><a href="category.html?category=Templates&sub=Email Templates">Email Templates</a></li>
      </ul>
    </div>
  </div>
</div>

<main class="container" style="margin-top:16px;">

  <div class="card">
    <h2 id="categoryTitle">Category</h2>

    <p id="categoryDescription"
       style="font-size:17px;line-height:1.5;margin-bottom:12px;"></p>

    <p id="categoryInfo" class="text-muted"></p>
  </div>

  <div id="subSection" class="card" style="display:none;">
    <h3 id="subTitle"></h3>
    <div id="subProducts" class="product-grid"></div>
    <p id="subEmpty" class="text-muted"></p>
  </div>

  <div id="otherSection" class="card" style="display:none;">
    <h3 id="otherTitle"></h3>
    <div id="otherProducts" class="product-grid"></div>
    <p id="otherEmpty" class="text-muted"></p>
  </div>

</main>

<!-- FOOTER -->
<footer class="footer"></footer>
<script>
  fetch("footer.html?v=3")
    .then(r => r.text())
    .then(d => document.querySelector(".footer").innerHTML = d)
    .catch(e => console.error("Footer load failed:", e));
</script>

<!-- CATEGORY LOGIC -->
<script type="module">
import { supabase } from "./js/supabase-config.js";

const params = new URLSearchParams(window.location.search);
const category = params.get("category");
const sub = params.get("sub");

const categoryTitle = document.getElementById("categoryTitle");
const categoryDescription = document.getElementById("categoryDescription");
const categoryInfo = document.getElementById("categoryInfo");

const subSection = document.getElementById("subSection");
const subTitle = document.getElementById("subTitle");
const subProducts = document.getElementById("subProducts");
const subEmpty = document.getElementById("subEmpty");

const otherSection = document.getElementById("otherSection");
const otherTitle = document.getElementById("otherTitle");
const otherProducts = document.getElementById("otherProducts");
const otherEmpty = document.getElementById("otherEmpty");

const categoryDescriptions = {
  "All":
    "Browse all digital products available on Silky Road, including ebooks, templates, creative assets, productivity tools, and more.",
  "Educational":
    "Explore ebooks, online courses, worksheets, tutorials, and digital workbooks created by independent educators.",
  "Creative Assets":
    "High-resolution stock photos, videos, music tracks, sound effects, digital art, fonts, brushes, Lightroom presets, and more.",
  "Productivity":
    "Boost your productivity with planners, journals, business templates, spreadsheets, social media packs, and Notion templates.",
  "Templates":
    "Editable Canva templates, printable games, craft patterns, email templates, and digital sticker packs."
};

async function loadCategory() {
  const cat = category || "All";

  // Title
  categoryTitle.textContent = (cat === "All") ? "All Products" : cat;

  // SEO description
  if (categoryDescriptions[cat]) {
    categoryDescription.textContent = categoryDescriptions[cat];
  } else {
    categoryDescription.textContent = "";
  }

  // Info text
  if (cat === "All") {
    categoryInfo.textContent = "Showing all products across all categories.";
  } else if (sub) {
    categoryInfo.textContent = "Showing sub-category: " + sub;
  } else {
    categoryInfo.textContent = "Showing all items in this category.";
  }

  // Build Supabase query
  let query = supabase
    .from("products")
    .select("*")
    .order("created_at", { ascending: false });

  if (cat !== "All") {
    query = query.eq("category", cat);
  }

  const { data, error } = await query;

  if (error) {
    console.error(error);
    categoryInfo.textContent = "Error loading products.";
    return;
  }

  if (!data || data.length === 0) {
    categoryInfo.textContent = "No products found yet.";
    return;
  }

  // If All ‚Üí just show all items, ignore sub
  if (cat === "All") {
    subSection.style.display = "block";
    subTitle.textContent = "All items";
    renderProducts(data, subProducts, subEmpty);
    otherSection.style.display = "none";
    return;
  }

  // If category has sub
  if (sub) {
    const primary = data.filter(p => (p.sub_category || "") === sub);
    const others = data.filter(p => (p.sub_category || "") !== sub);

    subSection.style.display = "block";
    subTitle.textContent = "Sub-category: " + sub;
    renderProducts(primary, subProducts, subEmpty);

    otherSection.style.display = "block";
    otherTitle.textContent = "Other items in " + cat;
    renderProducts(others, otherProducts, otherEmpty);
  } else {
    // No subcategory: show all for this category
    subSection.style.display = "block";
    subTitle.textContent = "All items in " + cat;
    renderProducts(data, subProducts, subEmpty);
    otherSection.style.display = "none";
  }
}

function renderProducts(items, container, emptyLabel) {
  container.innerHTML = "";
  if (!items || items.length === 0) {
    emptyLabel.textContent = "No products available.";
    return;
  }
  emptyLabel.textContent = "";

  items.forEach(p => {
    const card = document.createElement("div");
    card.className = "card product-card";

    const img = document.createElement("img");
    img.src = p.thumbnail_url || "placeholder.jpg";
    img.alt = p.title || "Product";
    img.style.cursor = "pointer";
    img.onclick = () => (window.location.href = "product.html?id=" + p.id);

    const title = document.createElement("h4");
    const link = document.createElement("a");
    link.textContent = p.title || "Untitled";
    link.href = "product.html?id=" + p.id;
    link.style.textDecoration = "none";
    link.style.color = "#222";
    title.appendChild(link);

    const price = document.createElement("p");
    price.innerHTML = "<strong>USD " + (p.price || 0).toFixed(2) + "</strong>";

    card.appendChild(img);
    card.appendChild(title);
    card.appendChild(price);

    container.appendChild(card);
  });
}

loadCategory();
</script>

</body>
</html>
