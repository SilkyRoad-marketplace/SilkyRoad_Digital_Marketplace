<!doctype html>
<html lang="en">
<head>
<link rel="stylesheet" href="styles.css">  
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" href="/favicon.png">
<title>Browse Category – Silky Road</title>

<meta name="description" content="Browse digital products by category on Silky Road Marketplace.">
<meta name="keywords" content="digital products, category, ebooks, downloads, silky road">

<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;background:#f7f7f9;color:#222}
.header{background:#fff;border-bottom:1px solid #e4e4e8}
.container{max-width:1100px;margin:0 auto;padding:16px}
nav{display:flex;align-items:center;justify-content:space-between}
nav .links a{margin-left:12px;text-decoration:none;color:#333;font-weight:600}
nav .links button{background:#2b6ef6;color:#fff;border:none;padding:10px 14px;border-radius:6px;cursor:pointer}

.banner{position:relative}
.banner img{width:100%;height:auto;display:block}
.banner-text{display:none !important;}

.card{
  background:#fff;
  padding:12px;
  border:1px solid #e6e6ea;
  box-sizing:border-box;
  margin-bottom:12px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
}

/* Product grid */
.product-grid{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
}
.card.product-card{
  width:calc(25% - 9px);
}
.card.product-card img{
  width:100%;
  height:auto;
  border-radius:6px;
}
.card.product-card h4{
  margin:8px 0 4px;
  font-size:16px;
}
.card.product-card p{
  margin:2px 0;
}

@media(max-width:600px){
  .card.product-card{width:calc(50% - 6px);}
}

.logo-img { height: 39px; width: auto; vertical-align: middle; }

.footer{background:#222;color:#fff;padding:12px;margin-top:20px;text-align:center}
button{background:#2b6ef6;color:#fff;border:none;padding:10px 14px;border-radius:6px;cursor:pointer}
.text-muted{color:#777;font-size:13px}
</style>
</head>

<body>

<div id="header"></div>
<script>
  fetch("header.html?v=1")
    .then(r => r.text())
    .then(d => document.getElementById("header").innerHTML = d)
    .catch(e => console.error("Header load failed:", e));
</script>

<div class="banner">
  <img src="banner.jpg" alt="Silky Road Banner">
  <div class="banner-text">
    <h1>Discover & Download Digital Products Instantly</h1>
  </div>
</div>

<main class="container" style="margin-top:16px;">

  <div class="card">
    <h2 id="categoryTitle">Category</h2>

    <!-- SEO DESCRIPTION -->
    <p id="categoryDescription" style="font-size:17px;line-height:1.5;margin-bottom:12px;"></p>

    <p id="categoryInfo" class="text-muted"></p>
  </div>

  <!-- Sub-category highlighted -->
  <div id="subSection" class="card" style="display:none;">
    <h3 id="subTitle"></h3>
    <div id="subProducts" class="product-grid"></div>
    <p id="subEmpty" class="text-muted"></p>
  </div>

  <!-- Other items -->
  <div id="otherSection" class="card" style="display:none;">
    <h3 id="otherTitle"></h3>
    <div id="otherProducts" class="product-grid"></div>
    <p id="otherEmpty" class="text-muted"></p>
  </div>

</main>

<!-- FOOTER -->
<footer class="footer"></footer>
<script>
  fetch("footer.html?v=2")
    .then(r => r.text())
    .then(d => document.querySelector(".footer").innerHTML = d)
    .catch(e => console.error("Footer load failed:", e));
</script>

<script type="module">
import { supabase } from "./js/supabase-config.js";

const params = new URLSearchParams(window.location.search);
const category = params.get("category");
const sub = params.get("sub"); // string from URL

const categoryTitle = document.getElementById("categoryTitle");
const categoryInfo = document.getElementById("categoryInfo");
const categoryDescription = document.getElementById("categoryDescription");
const subSection = document.getElementById("subSection");
const subTitle = document.getElementById("subTitle");
const subProducts = document.getElementById("subProducts");
const subEmpty = document.getElementById("subEmpty");
const otherSection = document.getElementById("otherSection");
const otherTitle = document.getElementById("otherTitle");
const otherProducts = document.getElementById("otherProducts");
const otherEmpty = document.getElementById("otherEmpty");

/* SEO DESCRIPTION OBJECT (same as before) */
const descriptions = {  
  "Educational": {
    "_main": "Discover educational digital products...",
    "eBooks": "Browse digital eBooks...",
    "Online Courses": "High-quality online courses...",
    "Worksheets": "Printable and digital worksheets...",
    "Tutorials": "Step-by-step digital tutorials...",
    "Digital Workbooks": "Structured workbooks to learn..."
  },

  "Creative Assets": {
    "_main": "Explore premium creative assets...",
    "Stock Photos": "High-resolution stock photos...",
    "Videos": "Download video clips...",
    "Music / Audio Tracks": "Download music tracks...",
    "Sound Effects": "Professional SFX library...",
    "Digital Art": "Download unique digital artworks...",
    "Fonts": "Creative fonts for branding...",
    "Brushes": "Digital brushes for Procreate...",
    "Lightroom Presets": "Instant photo enhancements...",
    "3D Models": "Ready-to-use 3D models...",
    "UI Kits": "UI Kits for apps and web...",
    "Website Themes": "Website themes and templates..."
  },

  "Productivity": {
    "_main": "Improve productivity with planners...",
    "Planners": "Digital planners for daily use...",
    "Journals": "Wellness and self-growth journals...",
    "Social Media Packs": "Marketing & social media templates...",
    "Business Templates": "Professional business documents...",
    "Spreadsheets": "Budget & finance spreadsheets...",
    "Notion Templates": "Powerful Notion templates..."
  },

  "Templates": {
    "_main": "Shop high-quality templates...",
    "Canva Templates": "Editable Canva templates...",
    "Website Themes": "Themes for websites & blogs...",
    "Digital Stickers": "Cute stickers for planners...",
    "Printable Games": "Printable party and school games...",
    "Craft Patterns": "Sewing & craft patterns...",
    "Email Templates": "Professional email layouts..."
  }
};

async function loadCategory() {
  if (!category) {
    categoryTitle.textContent = "All Products";
    return;
  }

  categoryTitle.textContent = category;

  // ⭐ FIX: Match URL sub with SEO descriptions
  if (sub && descriptions[category] && descriptions[category][sub]) {
    categoryDescription.textContent = descriptions[category][sub];
  } else if (descriptions[category] && descriptions[category]["_main"]) {
    categoryDescription.textContent = descriptions[category]["_main"];
  }

  const { data, error } = await supabase
    .from("products")
    .select("*")
    .eq("category", category)
    .order("created_at", { ascending: false });

  if (error) { console.error(error); return; }

  if (sub) {
    // ⭐ FIX: Use your DB column name sub_category
    const primary = data.filter(p => (p.sub_category || "") === sub);
    const others = data.filter(p => (p.sub_category || "") !== sub);

    subSection.style.display = "block";
    subTitle.textContent = "Sub-category: " + sub;
    renderProducts(primary, subProducts, subEmpty);

    otherSection.style.display = "block";
    otherTitle.textContent = "Other items in " + category;
    renderProducts(others, otherProducts, otherEmpty);

  } else {
    subSection.style.display = "block";
    subTitle.textContent = "All items in " + category;
    renderProducts(data, subProducts, subEmpty);
  }
}

function renderProducts(items, container, emptyLabel) {
  container.innerHTML = "";
  if (!items || items.length === 0) {
    emptyLabel.textContent = "No products available.";
    return;
  }
  emptyLabel.textContent = "";

  items.forEach(p => {
    const card = document.createElement("div");
    card.className = "card product-card";

    const img = document.createElement("img");
    img.src = p.thumbnail_url || "placeholder.jpg";
    img.style.cursor = "pointer";
    img.onclick = () => (window.location.href = "product.html?id=" + p.id);

    const title = document.createElement("h4");
    const link = document.createElement("a");
    link.textContent = p.title || "Untitled";
    link.href = "product.html?id=" + p.id;
    link.style.color = "#222";
    link.style.textDecoration = "none";
    title.appendChild(link);

    const price = document.createElement("p");
    price.innerHTML = "<strong>USD " + (p.price || 0).toFixed(2) + "</strong>";

    card.appendChild(img);
    card.appendChild(title);
    card.appendChild(price);
    container.appendChild(card);
  });
}

loadCategory();
</script>

</body>
</html>
