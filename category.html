<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" href="/favicon.png">
<title>Category - Silky Road</title>

<meta name="description" content="Browse digital products by category on Silky Road. Find ebooks, art, music, templates, software, and more. Instant downloads and secure payments.">
<meta name="keywords" content="digital marketplace, ebooks, art, music, software, templates, instant downloads">

<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;background:#f7f7f9;color:#222}
.header{background:#fff;border-bottom:1px solid #e4e4e8}
.container{max-width:1100px;margin:0 auto;padding:16px}
nav{display:flex;align-items:center;justify-content:space-between}
nav .links a{margin-left:12px;text-decoration:none;color:#333;font-weight:600}
nav .links button{background:#2b6ef6;color:#fff;border:none;padding:10px 14px;border-radius:6px;cursor:pointer}
.banner img{width:100%;height:auto;display:block;margin-bottom:16px}
.product-grid{display:flex;flex-wrap:wrap;gap:12px}
.card{background:#fff;padding:12px;border:1px solid #e6e6ea;width:calc(25% - 9px);box-sizing:border-box;margin-bottom:12px}
/* MOBILE */
@media(max-width:600px){.card{width:calc(50% - 6px)}}
button{background:#2b6ef6;color:#fff;border:none;padding:10px 14px;border-radius:6px;cursor:pointer}
.footer{background:#222;color:#fff;padding:12px;margin-top:20px;text-align:center}
</style>

<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/supabase-config.js"></script>
</head>
<body>

<header class="header">
  <div class="container">
    <nav>
      <div class="logo"><strong>Silky Road</strong></div>
      <div class="links">
        <a href="index.html">Home</a>
        <a href="contact.html">Contact Us</a>
        <a href="seller.html">Become a Seller</a>
        <a href="dashboard.html"><button>Seller Login</button></a>
      </div>
    </nav>
  </div>
</header>

<main class="container">
  <h2 id="category-title">Category</h2>
  <div class="product-grid" id="category-products">
    <p>Loading products...</p>
  </div>
</main>

<footer class="footer">
  Silky Road Digital Marketplace â€” Demo package
</footer>

<script>
// Get category and sub-category from URL
const urlParams = new URLSearchParams(window.location.search);
const categoryType = urlParams.get('category') || 'all';
const subCategoryType = urlParams.get('sub') || '';

document.getElementById('category-title').textContent = 
  subCategoryType 
    ? `Category: ${categoryType} > ${subCategoryType}` 
    : `Category: ${categoryType}`;

// Fetch products from Supabase
async function loadCategoryProducts() {
  let query = supabase.from('products').select('*');

  if (categoryType !== 'all') {
    query = query.eq('category', categoryType);
  }
  if (subCategoryType) {
    query = query.eq('sub_category', subCategoryType);
  }

  const { data: products, error } = await query;

  const container = document.getElementById('category-products');
  container.innerHTML = '';

  if (error) {
    container.innerHTML = `<p>Error loading products: ${error.message}</p>`;
    return;
  }

  if (!products || products.length === 0) {
    container.innerHTML = `<p>No products found in this category.</p>`;
    return;
  }

  products.forEach(product => {
    const card = document.createElement('div');
    card.classList.add('card');
    card.innerHTML = `
      <h4>${product.title}</h4>
      <p>Seller: ${product.seller_id}</p>
      <p><small>${product.filename}</small></p>
      <button>Buy</button>
    `;
    container.appendChild(card);
  });
}

loadCategoryProducts();
</script>

</body>
</html>
