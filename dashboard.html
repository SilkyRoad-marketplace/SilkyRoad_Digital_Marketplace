<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" href="/favicon.png">
<link rel="stylesheet" href="styles.css">
<title>Seller Dashboard – Silky Road</title>

<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;background:#f7f7f9;color:#222}
.container{max-width:1100px;margin:0 auto;padding:16px}

/* Banner */
.banner img{
  width:100%;
  height:auto;
  max-height:420px;
  object-fit:cover;
}

/* Layout */
.dashboard-wrapper{display:flex;gap:20px;margin-top:24px;}
.sidebar{
  width:230px;background:#fff;border:1px solid #e6e6ea;border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
}
.sidebar h3{
  margin:0;padding:14px 16px;border-bottom:1px solid #eee;font-size:16px;
}
.sidebar button{
  width:100%;background:none;border:none;text-align:left;padding:10px 16px;
  border-bottom:1px solid #f0f0f0;cursor:pointer;font-size:14px;
}
.sidebar button.active{background:#2b6ef6;color:#fff;}

.dashboard-content{
  flex:1;background:#fff;border:1px solid #e6e6ea;border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);padding:20px;
}

.logout-btn{
  background:#f44336;color:#fff;border:none;padding:8px 14px;border-radius:6px;cursor:pointer;
}

.input-field,.textarea-field{
  width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;
  margin-bottom:10px;font-size:14px;
}
.textarea-field{min-height:80px;resize:vertical;}

.summary-cards{display:flex;flex-wrap:wrap;gap:12px;margin-top:8px;}
.summary-card{
  flex:1;min-width:160px;background:#fafafa;border:1px solid #e6e6ea;
  border-radius:8px;padding:12px;
}

table{width:100%;border-collapse:collapse;font-size:14px;}
th,td{padding:8px;border-bottom:1px solid #eee;}
th{background:#fafafa;text-align:left;}

.upload-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
@media(max-width:800px){.dashboard-wrapper{flex-direction:column;}.sidebar{width:100%;}.upload-grid{grid-template-columns:1fr;}}

.notice{background:#fff8e1;border:1px solid #ffe0a3;padding:10px;border-radius:6px;margin-bottom:12px;}
.error-text{color:#d00;font-size:13px;}
.success-text{color:#089600;font-size:13px;}
.text-muted{color:#777;font-size:13px;}
</style>
</head>

<body>

<!-- HEADER -->
<div id="header"></div>
<script>
fetch("header.html?v=1").then(r=>r.text()).then(d=>header.innerHTML=d);
</script>

<!-- BANNER -->
<div class="banner">
  <img src="banner.jpg" alt="Silky Road Banner">
</div>

<main class="container">

  <div class="dashboard-header-row" style="display:flex;align-items:center;justify-content:space-between;margin-top:20px;">
    <div>
      <h1>Seller Dashboard</h1>
      <p id="welcomeLine" style="margin:4px 0;font-size:15px;">Loading your account…</p>
    </div>
    <button id="logoutBtn" class="logout-btn">Logout</button>
  </div>

  <div class="dashboard-wrapper">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <h3>Navigation</h3>
      <button class="nav-btn active" data-section="overview">Dashboard Home</button>
      <button class="nav-btn" data-section="products">My Products</button>
      <button class="nav-btn" data-section="upload">Upload Product</button>
      <button class="nav-btn" data-section="orders">My Orders</button>
      <button class="nav-btn" data-section="summary">Sales Summary</button>
      <button class="nav-btn" data-section="account">Account Settings</button>
    </aside>

    <!-- MAIN CONTENT -->
    <section class="dashboard-content">

      <!-- Overview -->
      <section id="section-overview">
        <h2>Overview</h2>
        <p>Use the sidebar to upload new products, manage your listings, and view your sales performance.</p>
      </section>

      <!-- My Products -->
      <section id="section-products" style="display:none;">
        <h2>My Products</h2>
        <table>
          <thead>
            <tr>
              <th>Main Image</th>
              <th>Title</th>
              <th>Category</th>
              <th>Price</th>
              <th>Coupon</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="productsTbody"></tbody>
        </table>
        <p id="productsEmpty" class="text-muted"></p>
      </section>

      <!-- Upload -->
      <section id="section-upload" style="display:none;">
        <h2>Upload Product</h2>

        <div id="uploadLockMessage" class="notice" style="display:none;">
          Please connect your PayPal email in <strong>Account Settings</strong> before uploading.
        </div>

        <form id="uploadForm">

          <div class="upload-grid">
            <div>
              <label>Title</label>
              <input id="productTitle" class="input-field" type="text" required>

              <label>Price (USD)</label>
              <input id="productPrice" class="input-field" type="number" step="0.01" required>

              <label>Category</label>
              <input id="productCategory" class="input-field" type="text">

              <label>Subcategory</label>
              <input id="productSubcategory" class="input-field" type="text">

              <label>External Download Link</label>
              <input id="externalLink" class="input-field" type="text" placeholder="https://...">
            </div>

            <div>
              <label>Description</label>
              <textarea id="productDescription" class="textarea-field"></textarea>

              <label>Main File (optional)</label>
              <input id="productFile" class="input-field" type="file">
            </div>
          </div>

          <h3>Product Images</h3>
          <div class="upload-grid">
            <div><label>Main Image</label><input id="image1" type="file" class="input-field"></div>
            <div><label>Image 2</label><input id="image2" type="file" class="input-field"></div>
            <div><label>Image 3</label><input id="image3" type="file" class="input-field"></div>
          </div>

          <h3>Coupon (Optional)</h3>
          <div class="upload-grid">
            <div><label>Coupon Code</label><input id="couponCode" class="input-field"></div>
            <div><label>Discount %</label><input id="couponPercent" class="input-field" type="number"></div>
          </div>

          <button id="uploadBtn" class="primary" type="submit">Upload Product</button>
          <p id="uploadMessage"></p>
        </form>
      </section>

      <!-- Orders -->
      <section id="section-orders" style="display:none;">
        <h2>My Orders</h2>
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Product</th>
              <th>Status</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody id="ordersTbody"></tbody>
        </table>
        <p id="ordersEmpty" class="text-muted"></p>
      </section>

      <!-- Summary -->
      <section id="section-summary" style="display:none;">
        <h2>Sales Summary</h2>
        <div class="summary-cards">
          <div class="summary-card">
            <p class="text-muted">Total Orders</p>
            <p id="summaryOrders" style="font-size:20px;font-weight:bold;">0</p>
          </div>
          <div class="summary-card">
            <p class="text-muted">Revenue</p>
            <p id="summaryRevenue" style="font-size:20px;font-weight:bold;">USD 0.00</p>
          </div>
        </div>
      </section>

      <!-- Account Settings -->
      <section id="section-account" style="display:none;">
        <h2>Account Settings</h2>

        <form id="accountForm">
          <div class="upload-grid">
            <div>
              <label>First Name</label>
              <input id="accFirstName" class="input-field">

              <label>Last Name</label>
              <input id="accLastName" class="input-field">
            </div>
            <div>
              <label>Display Name</label>
              <input id="accDisplayName" class="input-field">

              <label>PayPal Email</label>
              <input id="accPaypalEmail" class="input-field">
            </div>
          </div>

          <button class="primary" type="submit">Save Settings</button>
          <p id="accountMessage"></p>
        </form>

      </section>

    </section><!-- /dashboard-content -->
  </div><!-- /dashboard-wrapper -->
</main>

<!-- FOOTER -->
<footer class="footer"></footer>
<script>
fetch("footer.html?v=1").then(r=>r.text()).then(d=>document.querySelector(".footer").innerHTML=d);
</script>

<!-- DASHBOARD LOGIC -->
<script type="module">
import { supabase } from "./js/supabase-config.js";

/* The entire JS logic remains the same EXCEPT delete account removed */

const navBtns=document.querySelectorAll(".nav-btn");
const sectionIds=["overview","products","upload","orders","summary","account"];

function showSection(s){
  sectionIds.forEach(id=>{
    document.getElementById("section-"+id).style.display=(id===s?'block':'none');
  });
  navBtns.forEach(btn=>btn.classList.toggle("active",btn.dataset.section===s));
}
navBtns.forEach(btn=>btn.onclick=()=>showSection(btn.dataset.section));

/* Load session */
supabase.auth.getSession().then(async ({data})=>{
  if(!data.session){location.href="login.html";return;}
  const user=data.session.user;

  const md=user.user_metadata||{};
  const name=(md.first_name?md.first_name+' ':'')+(md.last_name||'');
  welcomeLine.textContent="Welcome, "+(name.trim()||md.display_name||user.email);

  setupLogout();
  setupAccount(user);
  setupUpload(user);
  loadMyProducts(user);
  loadOrdersAndSummary(user);
});

/* Logout */
function setupLogout(){
  logoutBtn.onclick=async()=>{
    await supabase.auth.signOut();
    location.href="login.html";
  };
}

/* Account Settings (same but no delete account JS) */
function setupAccount(user){
  const md=user.user_metadata||{};
  accFirstName.value=md.first_name||"";
  accLastName.value=md.last_name||"";
  accDisplayName.value=md.display_name||"";
  accPaypalEmail.value=md.paypal_email||"";

  accountForm.onsubmit=async e=>{
    e.preventDefault();
    const fn=accFirstName.value.trim();
    const ln=accLastName.value.trim();
    const dn=accDisplayName.value.trim();
    const pp=accPaypalEmail.value.trim();

    if(!pp){accountMessage.textContent="PayPal email required.";accountMessage.className="error-text";return;}

    const {error}=await supabase.auth.updateUser({
      data:{first_name:fn,last_name:ln,display_name:dn,paypal_email:pp}
    });
    if(error){
      accountMessage.textContent=error.message;
      accountMessage.className="error-text";
    } else{
      accountMessage.textContent="Saved.";
      accountMessage.className="success-text";
    }
  };

  checkUploadLock(md.paypal_email||"");
}

/* Upload → unchanged except delete removed */
function checkUploadLock(pp){
  const lock=uploadLockMessage;
  const btn=uploadBtn;
  if(!pp){
    lock.style.display="block";
    btn.disabled=true;
  } else{
    lock.style.display="none";
    btn.disabled=false;
  }
}

/* ---- Upload, Products, Orders, Summary functions stay SAME ---- */

</script>

</body>
</html>
