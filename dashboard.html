<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard â€“ Silky Road</title>
<link rel="stylesheet" href="styles.css">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f7f7f9;
  margin:0;
  padding:0;
}

/* Center login box */
.center-box{
  max-width:400px;
  margin:40px auto;
  background:#fff;
  padding:24px;
  border-radius:10px;
  border:1px solid #e6e6ea;
  box-shadow:0 2px 8px rgba(0,0,0,0.06);
}

/* Input fields */
.input-field{
  width:100%;
  padding:12px;
  margin:8px 0 16px;
  border:1px solid #ccc;
  border-radius:6px;
  font-size:15px;
}

/* Buttons */
.btn{
  width:100%;
  padding:12px;
  border:none;
  border-radius:6px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
}

.btn-login{
  background:#0066ff;
  color:#fff;
}

.btn-google{
  background:#dd4b39;
  color:#fff;
  margin-top:10px;
}

.btn-forgot{
  margin-top:10px;
  background:#444;
  color:#fff;
}

.dashboard-box{
  max-width:900px;
  margin:30px auto;
  background:#fff;
  padding:24px;
  border-radius:10px;
  border:1px solid #e6e6ea;
  box-shadow:0 2px 8px rgba(0,0,0,0.06);
}

.logout-btn{
  background:#f33;
  color:#fff;
  padding:10px 16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  float:right;
  font-weight:bold;
}

.username{
  font-size:18px;
  margin-bottom:10px;
  color:#222;
  font-weight:bold;
}

.text-muted{
  color:#666;
  font-size:13px;
  margin-top:12px;
  text-align:center;
}

</style>

</head>
<body>

<!-- ========================================================== -->
<!-- AUTO LOGIN OR DASHBOARD (ALL HANDLED BY JS BELOW)          -->
<!-- ========================================================== -->

<div id="content"></div>

<!-- Supabase Auth Logic -->
<script type="module">
import { supabase } from "./js/supabase-config.js";

const content = document.getElementById("content");

// ðŸ”µ FUNCTION 1 â€” Show Login Screen
function showLoginUI(){
  content.innerHTML = `
    <div class="center-box">
      <h2 style="text-align:center;">Login to Silky Road</h2>

      <input type="email" id="email" class="input-field" placeholder="Email">
      <input type="password" id="password" class="input-field" placeholder="Password">

      <button id="emailLoginBtn" class="btn btn-login">Sign in with Email</button>
      <button id="googleLoginBtn" class="btn btn-google">Sign in with Google</button>
      <button id="forgotBtn" class="btn btn-forgot">Forgot Password?</button>

      <p id="loginMessage" class="text-muted"></p>
    </div>
  `;

  // â­ EMAIL LOGIN HANDLER
  document.getElementById("emailLoginBtn").onclick = async () => {
    let email = document.getElementById("email").value.trim();
    let password = document.getElementById("password").value.trim();

    const { error } = await supabase.auth.signInWithPassword({ email, password });

    if (error){
      document.getElementById("loginMessage").textContent = "Invalid email or password.";
      return;
    }

    window.location.reload(); // reload to show dashboard
  };

  // â­ GOOGLE LOGIN
  document.getElementById("googleLoginBtn").onclick = async () => {
    const { error } = await supabase.auth.signInWithOAuth({
      provider: "google",
      options: {
        redirectTo: "https://silkyroad.vercel.app/dashboard.html"
      }
    });
    if (error){
      alert("Google login failed.");
    }
  };

  // â­ FORGOT PASSWORD
  document.getElementById("forgotBtn").onclick = () => {
    window.location.href = "forgot.html";
  };
}

// ðŸ”µ FUNCTION 2 â€” Show Dashboard
function showDashboardUI(user){
  const name = user.email.split("@")[0];

  content.innerHTML = `
    <div class="dashboard-box">
      <button id="logoutBtn" class="logout-btn">Logout</button>
      <h2>Welcome to your Dashboard</h2>

      <p class="username">Hello, ${name}</p>

      <p>Here is your Silky Road seller/buyer dashboard.</p>

      <ul style="line-height:1.8;">
        <li><a href="my-products.html">My Products</a></li>
        <li><a href="upload.html">Upload New Product</a></li>
        <li><a href="orders.html">My Orders</a></li>
        <li><a href="account.html">Account Settings</a></li>
      </ul>
    </div>
  `;

  // â­ LOGOUT BUTTON
  document.getElementById("logoutBtn").onclick = async () => {
    await supabase.auth.signOut();
    window.location.reload(); // Refresh to show login
  };
}

// =============================================================
// MAIN LOGIC â€” CHECK IF LOGGED IN OR SHOW LOGIN
// =============================================================

supabase.auth.getSession().then(({ data }) => {
  if (data.session){
    // user is logged in â†’ show dashboard
    showDashboardUI(data.session.user);
  } else {
    // user not logged in â†’ show login UI
    showLoginUI();
  }
});
</script>

</body>
</html>
